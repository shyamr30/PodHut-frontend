{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { useStateWithCallback } from \"./useStateWithCallback\";\nexport const useWebRTC = (roomId, user) => {\n  _s();\n\n  const [clients, setClients] = useStateWithCallback([]);\n  const audioElements = useRef({});\n  const connections = useRef({});\n  const localMediaStream = useRef(null);\n\n  const provideRef = (instance, userId) => {\n    audioElements.current[userId] = instance;\n  };\n\n  const addNewClients = useCallback((newClient, cb) => {\n    const lookingFor = clients.find(client => client.id === newClient.id);\n\n    if (lookingFor === undefined) {\n      setClients(existingClients => [...existingClients, newClient], cb);\n    }\n  }, [clients, setClients]); //capture media\n\n  useEffect(() => {\n    const startCapture = async () => {\n      localMediaStream.current = await navigator.mediaDevices.getUserMedia({\n        audio: true\n      });\n    };\n\n    startCapture().then(() => {\n      addNewClients(user, () => {\n        const localElement = audioElements.current[user.id];\n\n        if (localElement) {\n          localElement.volume = 0;\n          localElement.srcObject = localMediaStream.current;\n        } //socket emit JOIN socket.io\n\n      });\n    });\n  }, []);\n  return {\n    clients,\n    provideRef\n  };\n};\n\n_s(useWebRTC, \"9PpG9axBHvruFORqSAMV5/lg22c=\", false, function () {\n  return [useStateWithCallback];\n});","map":{"version":3,"sources":["E:/College Assignment/Sem 6/SDP Project/project/frontend/src/hooks/useWebRTC.js"],"names":["useCallback","useEffect","useRef","useStateWithCallback","useWebRTC","roomId","user","clients","setClients","audioElements","connections","localMediaStream","provideRef","instance","userId","current","addNewClients","newClient","cb","lookingFor","find","client","id","undefined","existingClients","startCapture","navigator","mediaDevices","getUserMedia","audio","then","localElement","volume","srcObject"],"mappings":";;AAAA,SAASA,WAAT,EAAsBC,SAAtB,EAAiCC,MAAjC,QAA+C,OAA/C;AACA,SAASC,oBAAT,QAAqC,wBAArC;AAEA,OAAO,MAAMC,SAAS,GAAG,CAACC,MAAD,EAASC,IAAT,KAAkB;AAAA;;AACvC,QAAM,CAACC,OAAD,EAAUC,UAAV,IAAwBL,oBAAoB,CAAC,EAAD,CAAlD;AACA,QAAMM,aAAa,GAAGP,MAAM,CAAC,EAAD,CAA5B;AACA,QAAMQ,WAAW,GAAGR,MAAM,CAAC,EAAD,CAA1B;AACA,QAAMS,gBAAgB,GAAGT,MAAM,CAAC,IAAD,CAA/B;;AAEA,QAAMU,UAAU,GAAG,CAACC,QAAD,EAAWC,MAAX,KAAsB;AACrCL,IAAAA,aAAa,CAACM,OAAd,CAAsBD,MAAtB,IAAgCD,QAAhC;AACH,GAFD;;AAIA,QAAMG,aAAa,GAAGhB,WAAW,CAAC,CAACiB,SAAD,EAAYC,EAAZ,KAAmB;AAC7C,UAAMC,UAAU,GAAGZ,OAAO,CAACa,IAAR,CAAcC,MAAD,IAAYA,MAAM,CAACC,EAAP,KAAcL,SAAS,CAACK,EAAjD,CAAnB;;AACA,QAAGH,UAAU,KAAKI,SAAlB,EAA6B;AACzBf,MAAAA,UAAU,CAAEgB,eAAD,IAAqB,CAAC,GAAGA,eAAJ,EAAqBP,SAArB,CAAtB,EAAuDC,EAAvD,CAAV;AACH;AACJ,GAL4B,EAM7B,CAACX,OAAD,EAASC,UAAT,CAN6B,CAAjC,CAVuC,CAkBvC;;AACAP,EAAAA,SAAS,CAAC,MAAM;AACZ,UAAMwB,YAAY,GAAG,YAAY;AAC7Bd,MAAAA,gBAAgB,CAACI,OAAjB,GAA2B,MAAMW,SAAS,CAACC,YAAV,CAAuBC,YAAvB,CAAoC;AACjEC,QAAAA,KAAK,EAAE;AAD0D,OAApC,CAAjC;AAGH,KAJD;;AAKAJ,IAAAA,YAAY,GAAGK,IAAf,CAAoB,MAAM;AACtBd,MAAAA,aAAa,CAACV,IAAD,EAAO,MAAM;AACtB,cAAMyB,YAAY,GAAGtB,aAAa,CAACM,OAAd,CAAsBT,IAAI,CAACgB,EAA3B,CAArB;;AACA,YAAGS,YAAH,EAAiB;AACbA,UAAAA,YAAY,CAACC,MAAb,GAAsB,CAAtB;AACAD,UAAAA,YAAY,CAACE,SAAb,GAAyBtB,gBAAgB,CAACI,OAA1C;AACH,SALqB,CAOtB;;AACH,OARY,CAAb;AASH,KAVD;AAWH,GAjBQ,EAiBN,EAjBM,CAAT;AAmBA,SAAO;AAACR,IAAAA,OAAD;AAAUK,IAAAA;AAAV,GAAP;AACH,CAvCM;;GAAMR,S;UACqBD,oB","sourcesContent":["import { useCallback, useEffect, useRef } from \"react\";\r\nimport { useStateWithCallback } from \"./useStateWithCallback\";\r\n\r\nexport const useWebRTC = (roomId, user) => {\r\n    const [clients, setClients] = useStateWithCallback([]);\r\n    const audioElements = useRef({});\r\n    const connections = useRef({});\r\n    const localMediaStream = useRef(null);\r\n\r\n    const provideRef = (instance, userId) => {\r\n        audioElements.current[userId] = instance;\r\n    };\r\n\r\n    const addNewClients = useCallback((newClient, cb) => {\r\n            const lookingFor = clients.find((client) => client.id === newClient.id);\r\n            if(lookingFor === undefined) {\r\n                setClients((existingClients) => [...existingClients, newClient], cb);\r\n            }\r\n        },\r\n        [clients,setClients],\r\n    );\r\n    //capture media\r\n    useEffect(() => {\r\n        const startCapture = async () => {\r\n            localMediaStream.current = await navigator.mediaDevices.getUserMedia({\r\n                audio: true\r\n            });\r\n        };\r\n        startCapture().then(() => {\r\n            addNewClients(user, () => {\r\n                const localElement = audioElements.current[user.id];\r\n                if(localElement) {\r\n                    localElement.volume = 0;\r\n                    localElement.srcObject = localMediaStream.current;\r\n                }\r\n\r\n                //socket emit JOIN socket.io\r\n            })\r\n        });\r\n    }, []);\r\n\r\n    return {clients, provideRef};\r\n}"]},"metadata":{},"sourceType":"module"}